<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title><p><strong>Backend</strong></p> - VIALAND 开发文档</title>
  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "<p><strong>Backend</strong></p>";
    var mkdocs_page_input_path = "Backend.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> VIALAND 开发文档</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1 current">
		
    <a class="current" href="./"><p><strong>Backend</strong></p></a>
    <ul class="subnav">
            
    <li class="toctree-l2"><a href="#v20">v2.0</a></li>
    
        <ul>
        
            <li><a class="toctree-l3" href="#-contracts-">----- Contracts -----</a></li>
        
            <li><a class="toctree-l3" href="#-public-features-">----- Public features -----</a></li>
        
            <li><a class="toctree-l3" href="#-events-">----- Events -----</a></li>
        
            <li><a class="toctree-l3" href="#-scripts-">----- Scripts -----</a></li>
        
        </ul>
    

    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../Frontend/"><p><b>Frontend</b></p></a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../_note/"><p><b>Use Doc</b></p></a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">VIALAND 开发文档</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li><p><strong>Backend</strong></p></li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="v20">v2.0</h1>
<h2 id="-contracts-">----- Contracts -----</h2>
<h3 id="viavaultsol">ViaVault.sol</h3>
<pre><code>. funds vault. 
. manage funds deposit/withdraw and calculate shares
</code></pre>
<h3 id="vaultstrategysol">VaultStrategy.sol</h3>
<pre><code>. manage strategies
. manage rebalance
</code></pre>
<h3 id="vaultfactorysol">VaultFactory.sol</h3>
<pre><code>. administration of vaults and strategies
. vault and strategy registration
. set/get admin and team 
. change vault status
. call deployer to create vault in air
</code></pre>
<h2 id="-public-features-">----- Public features -----</h2>
<h3 id="vaultfactory">VaultFactory</h3>
<h4 id="public-properties">public properties</h4>
<pre><code>mapping (address =&gt; mapping(address =&gt;uint )) public stat;   // 1: active ; 2 pending;  3 emergency ; 4 abandoned     
mapping (address =&gt; address) public pairs;  // strategy &lt;-&gt;  vault   
VaultReg[] public vaults;
    struct VaultReg {
        address strategy;
        address vault;
    }
</code></pre>
<h4 id="public-methods">public methods</h4>
<pre><code>function getAdmin() external view returns(address);
function getTeam() external view returns(address);
function setTeam(address _team) external;
function changeStat(address _strategy, address _vault, uint _stat) external;   // change status of vault and strategy
function getCount() external;    // get stored vaults array size
function getStat(address) external view returns(uint);      // get status of vault and strategy. 1 = active
function getPair0(address _addr) external view returns(address);        // get vault or strategy address by given strategy or vault address
</code></pre>
<h3 id="viavault">ViaVault</h3>
<h4 id="public-properties_1">public properties</h4>
<pre><code>address public immutable factory;  // vaultFactory 
address public immutable token0;   // token0
address public immutable token1;   // token1

uint256 public vaultCap;        // maxTotalSupply
uint256 public individualCap;   // max Individual supply : todo

Withdrawal[] public wds;        // pending withdrawal array
    struct Withdrawal {
        address recipient;
        uint8 percent;
    }
</code></pre>
<h4 id="public-methods_1">public methods</h4>
<pre><code>function deposit( uint256 amountIn0, uint256 amountIn1) external
function withdraw( uint8 percent ) external nonReentrant returns (uint256 amount0, uint256 amount1)
function setVaultCap(uint256 newMax) external onlyAdmin
function setIndividualCap(uint256 newMax) external onlyAdmin
function checkCap(uint256 amount0,uint256 amount1) public view returns(uint256)
function sweep( address _token, uint256 amount) external  onlyAdmin
</code></pre>
<h3 id="vaultstrategy">VaultStrategy</h3>
<h4 id="public-properties_2">public properties</h4>
<pre><code>address public creator;         // the strategy creator. if it's deployed by admin team, creator is admin  team
address public immutable factory;   // the vault factory
address public immutable _WETH;
address public immutable token0;         // underlying token0
address public immutable token1;         // underlying token1
address public protocol;            // where fee cuts to protocol 
ICEth public immutable _CETH;
IUniswapV3Pool public immutable pool;        // get by uni factory, token0, token1, feetier
uint128 public immutable quoteamount;       // base amount for calculating price, based on token0 decimal, ie: 1e18 for eth, 1e8 for wbtc
uint8 public uniPortion;       // uniswap portion ratio
uint8 public compPortion;       // compound portion ratio
uint8 public protocolFeeRate;       // 0 - 20% of profit
uint8 public motivatorFeeRate;      // 0- 10% from profit for keeping system running by press buttons
uint32 public twapDuration;        // oracle twap durantion
int24 public tickSpacing;
int24 public cLow;
int24 public cHigh;
int24 public maxTwapDeviation;     // for twap

mapping (address =&gt; address) public _CTOKEN;
mapping (address =&gt; uint8) public Decimals;

// to be working
mapping (uint =&gt; address[] ) public motivator;      // who helped to triggering buttons e.g. motivator[1].push( address )  1=rebalance
address[] public motivators;
</code></pre>
<h4 id="public-methods_2">public methods</h4>
<pre><code> function rebalance(int24 newLow, int24 newHigh) external nonReentrant
 function setMaxTwapDeviation(int24 _maxTwapDeviation) external onlyCreator
 function setTwapDuration(uint32 _twapDuration) external onlyCreator
 function setPortionRatio(uint8 uni, uint8 comp) external onlyCreator {
 function alloc() public returns ( bool )
 function calcShares( uint256 totalSupply, uint256 amountIn0, uint256 amountIn1) public returns(uint256 shares, uint256 amount0, uint256 amount1)
 function getUniAmounts(int24 tickLower, int24 tickUpper)  public view returns (uint256 amount0, uint256 amount1) 
 function getPrice() public view returns(uint256) -- get price at twap
</code></pre>
<h2 id="-events-">----- Events -----</h2>
<h3 id="1">1</h3>
<h3 id="2">2</h3>
<h3 id="3">3</h3>
<h2 id="-scripts-">----- Scripts -----</h2>
<h3 id="1_1">1</h3>
<h3 id="2_1">2</h3>
<h3 id="3_1">3</h3>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Frontend/" class="btn btn-neutral float-right" title="<p><b>Frontend</b></p>">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
      
        <span style="margin-left: 15px"><a href="../Frontend/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
